import{r as g,S as J,x as Q,j as e,y as p,L as q}from"./index-bf82c2d2.js";import{C as H,k as V,T as $,S as W,v as X,U as Z,D as y,d as ee,e as se,M as ae,I as te,E as ne,s as le}from"./Layout-175bf00a.js";import{T as re,a as ie,C as de,S as oe}from"./BulkActionDrawer-e925344e.js";import{u as me,n as P,b as z,L,E as K}from"./index.esm-47afe3d2.js";import{I as ce}from"./InputArea-3fddad50.js";const pe=(i,c)=>{const{isDrawerOpen:d,closeDrawer:n,setIsUpdate:N,lang:x}=g.useContext(J),[S,T]=g.useState({}),[b,v]=g.useState(""),[I,C]=g.useState(""),[s,u]=g.useState([]),[o,m]=g.useState(x),[D,_]=g.useState(!0),[A,E]=g.useState(""),[U,j]=g.useState(!1),{register:B,handleSubmit:a,setValue:t,clearErrors:l,reset:w,formState:{errors:O}}=me(),Y=async({name:h,description:r})=>{var M,R;try{j(!0);const f=await V(h,o),he=await V(r,o),k={name:h,description:r,parentId:b||void 0,parentName:A||"Home",icon:I,status:D?"show":"hide"};if(i){const F=await H.updateCategory(i,k);N(!0),j(!1),z(F.message),n(),w()}else{const F=await H.addCategory(k);N(!0),j(!1),z(F.message),n()}}catch(f){j(!1),P(f?(R=(M=f==null?void 0:f.response)==null?void 0:M.data)==null?void 0:R.message:f==null?void 0:f.message),n()}},G=h=>{m(h),Object.keys(S).length>0&&(t("name",S.name[h||"en"]),t("description",S.description[h||"en"]))};return g.useEffect(()=>{var h;if(!d){T({}),t("name"),t("parentId"),t("parentName"),t("description"),t("icon"),C(""),_(!0),l("name"),l("parentId"),l("parentName"),l("description"),E("Home"),m(x),t("language",o),c!==void 0&&((h=c[0])==null?void 0:h._id)!==void 0&&v(c[0]._id);return}i&&(async()=>{try{const r=await H.getCategoryById(i);r&&(T(r),t("name",r.name),t("description",r.description),t("language",o),t("parentId",r.parentId),t("parentName",r.parentName),E(r.parentName),v(r.parentId),C([r.icon]),_(r.status==="show"))}catch(r){P(r?r.response.data.message:r.message)}})()},[i,t,d,o,l,c,x]),{register:B,handleSubmit:a,onSubmit:Y,errors:O,imageUrl:I,setImageUrl:C,children:s,setChildren:u,published:D,setPublished:_,checked:b,setChecked:v,isSubmitting:U,selectCategoryName:A,setSelectCategoryName:E,handleSelectLanguage:G}},xe=({id:i,data:c,lang:d})=>{const{t:n}=Q(),{checked:N,register:x,onSubmit:S,handleSubmit:T,errors:b,imageUrl:v,setImageUrl:I,published:C,setPublished:s,setChecked:u,selectCategoryName:o,setSelectCategoryName:m,handleSelectLanguage:D,isSubmitting:_}=pe(i,c),A=`
  .rc-tree-child-tree {
    display: hidden;
  }
  .node-motion {
    transition: all .3s;
    overflow-y: hidden;
  }
`,E={motionName:"node-motion",motionAppear:!1,onAppearStart:a=>({height:0}),onAppearActive:a=>({height:a.scrollHeight}),onLeaveStart:a=>({height:a.offsetHeight}),onLeaveActive:()=>({height:0})},U=a=>{let t=[];for(let l of a)t.push({title:l.name,key:l._id,children:l.children.length>0&&U(l.children)});return t},j=(a,t)=>{var l;return a._id===t?a:(l=a==null?void 0:a.children)==null?void 0:l.reduce((w,O)=>w??j(O,t),void 0)},B=async a=>{if(a!==void 0)if(i){const t=await H.getCategoryById(a);if(i===a)return P("This can't be select as a parent category!");if(i===t.parentId)return P("This can't be select as a parent category!");{if(a===void 0)return;u(a);const l=c[0],w=j(l,a);m(w==null?void 0:w.name)}}else{if(a===void 0)return;u(a);const t=c[0],l=j(t,a);m(l==null?void 0:l.name)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full relative p-6 border-b border-gray-100 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300",children:i?e.jsx($,{register:x,handleSelectLanguage:D,title:n("UpdateCategory"),description:n("UpdateCategoryDescription")}):e.jsx($,{register:x,handleSelectLanguage:D,title:n("AddCategoryTitle"),description:n("AddCategoryDescription")})}),e.jsx(W,{className:"w-full md:w-7/12 lg:w-8/12 xl:w-8/12 relative dark:bg-gray-700 dark:text-gray-200",children:e.jsxs("form",{onSubmit:T(S),children:[e.jsxs("div",{className:"p-6 flex-grow scrollbar-hide w-full max-h-full pb-40",children:[e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Name")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(ce,{register:x,label:"Category title",name:"name",type:"text",placeholder:n("ParentCategoryPlaceholder")}),e.jsx(K,{errorName:b.name})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Description")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4",children:[e.jsx(re,{required:!0,register:x,label:"Description",name:"description",type:"text",placeholder:"Category Description"}),e.jsx(K,{errorName:b.description})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("ParentCategory")}),e.jsxs("div",{className:"col-span-8 sm:col-span-4 relative",children:[e.jsx(p.Input,{readOnly:!0,...x("parent",{required:!1}),name:"parent",value:o||"Home",placeholder:n("ParentCategory"),type:"text",className:"border h-12 w-full text-sm focus:outline-none block bg-gray-100 dark:bg-white border-transparent focus:bg-white"}),e.jsxs("div",{className:"draggable-demo capitalize",children:[e.jsx("style",{dangerouslySetInnerHTML:{__html:A}}),e.jsx(X,{expandAction:"click",treeData:U(c),selectedKeys:[N],onSelect:a=>B(a[0]),motion:E,animation:"slide-up"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("CategoryIcon")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(Z,{imageUrl:v,setImageUrl:I,folder:"category"})})]}),e.jsxs("div",{className:"grid grid-cols-6 gap-3 md:gap-5 xl:gap-6 lg:gap-6 mb-6",children:[e.jsx(L,{label:n("Published")}),e.jsx("div",{className:"col-span-8 sm:col-span-4",children:e.jsx(ie,{handleProcess:s,processOption:C})})]})]}),e.jsx(y,{id:i,title:"Category",isSubmitting:_})]})})]})},Ne=({data:i,lang:c,isCheck:d,categories:n,setIsCheck:N,useParamId:x,showChild:S})=>{const{title:T,serviceId:b,handleModalOpen:v,handleUpdate:I}=ee(),C=s=>{const{id:u,checked:o}=s.target;N([...d,u]),o||N(d.filter(m=>m!==u))};return e.jsxs(e.Fragment,{children:[(d==null?void 0:d.length)<1&&e.jsx(se,{useParamId:x,id:b,title:T}),e.jsx(ae,{children:e.jsx(xe,{id:b,data:i,lang:c})}),e.jsx(p.TableBody,{children:n==null?void 0:n.map(s=>{var u,o;return e.jsxs(p.TableRow,{children:[e.jsx(p.TableCell,{children:e.jsx(de,{type:"checkbox",name:"category",id:s._id,handleClick:C,isChecked:d==null?void 0:d.includes(s._id)})}),e.jsx(p.TableCell,{className:"font-semibold uppercase text-xs",children:(u=s==null?void 0:s._id)==null?void 0:u.substring(20,24)}),e.jsx(p.TableCell,{children:s!=null&&s.icon?e.jsx(p.Avatar,{className:"hidden mr-3 md:block bg-gray-50 p-1",src:s==null?void 0:s.icon,alt:s==null?void 0:s.parent}):e.jsx(p.Avatar,{src:"https://res.cloudinary.com/ahossain/image/upload/v1655097002/placeholder_kvepfp.png",alt:"product",className:"hidden p-1 mr-2 md:block bg-gray-50 shadow-none"})}),e.jsx(p.TableCell,{className:"font-medium text-sm ",children:(s==null?void 0:s.children.length)>0?e.jsxs(q,{to:`/categories/${s==null?void 0:s._id}`,className:"text-blue-700",children:[s==null?void 0:s.name,e.jsx(e.Fragment,{children:S&&e.jsxs(e.Fragment,{children:[" ",e.jsx("div",{className:"pl-2 ",children:(o=s==null?void 0:s.children)==null?void 0:o.map(m=>e.jsx("div",{children:e.jsx(q,{to:`/categories/${m==null?void 0:m._id}`,className:"text-blue-700",children:e.jsxs("div",{className:"flex text-xs items-center  text-blue-800",children:[e.jsx("span",{className:" text-xs text-gray-500 pr-1",children:e.jsx(te,{})}),e.jsx("span",{className:"text-gray-500",children:m.name})]})})},m._id))})]})})]}):e.jsx("span",{children:s==null?void 0:s.name})}),e.jsx(p.TableCell,{className:"text-sm",children:s==null?void 0:s.description}),e.jsx(p.TableCell,{className:"text-center",children:e.jsx(oe,{id:s._id,category:!0,status:s.status})}),e.jsx(p.TableCell,{children:e.jsx(ne,{id:s==null?void 0:s._id,parent:s,isCheck:d,children:s==null?void 0:s.children,handleUpdate:I,handleModalOpen:v,title:le(s==null?void 0:s.name,c)})})]},s._id)})})]})};export{xe as C,Ne as a};
